# ネットワーク階層シミュレータ 設計書 (Go言語版)

| 版数 | 日付       | 作成者     | 概要     |
| ---- | ---------- | ---------- | -------- |
| 1.0  | 202X/XX/XX | [開発者名] | 新規作成 |

## プロジェクト概要

### 1.1 目的

OSI参照モデル（7階層）に基づいたデータ通信プロセスをGo言語（Golang）を用いて実装し、以下の概念を実証・学習することを目的とする。

- 階層化 (Layering): 通信機能を階層ごとに分割し、責任を分離する。
- カプセル化 (Encapsulation): 上位層のデータを下位層が「ペイロード」として包み込み、ヘッダーを付与して隠蔽する。
- インターフェース: 異なる層が共通のルールで接続する。

### 1.2 スコープ

テキストデータの送信（カプセル化）から受信（非カプセル化）までのプロセスをシミュレートする。  
実際のネットワーク通信（TCP/IPソケット等）は行わず、メモリ上の構造体操作で模倣する。  
CUI（コンソール）アプリケーションとして動作する。

## アーキテクチャ設計

### 2.1 技術スタック

言語: Go (Golang)  
設計思想: オブジェクト指向的な構造体設計と、Go特有のパッケージ可視性ルールを用いた情報隠蔽。

### 2.2 ディレクトリ構成

情報隠蔽（Private/Publicの制御）を強制するため、メイン処理とライブラリを分離する。

```text
network-simulator/
├── main.go          # エントリーポイント (実行ファイル)
├── go.mod           # モジュール定義
└── layers/          # ネットワーク層パッケージ
    ├── interface.go # 共通インターフェース
    ├── packet.go    # データ構造体
    ├── app_layer.go # 第7層 実装
    ├── pres_layer.go # 第6層 実装
    ...
    └── phys_layer.go # 第1層 実装
```

### 2.3 情報隠蔽の方針

構造体フィールドの小文字化: 各層が保持する内部データ（IPアドレスやポート番号など）は、変数名の先頭を小文字にすることでmainパッケージからの直接アクセスを禁止する。  
コンストラクタ関数: 外部から値を設定する場合は、必ず NewLayerName(...) といったコンストラクタ関数を経由させる。

## データ構造定義

### 3.1 Packet（パケット）

各層間で受け渡しを行う共通のデータ構造。

```go
type Packet struct {
    Headers []string // 付与されたヘッダーの履歴
    Payload string   // データ本体
}
```

### 3.2 Layer Interface（共通インターフェース）

全ての階層（構造体）は以下のインターフェースを実装する。

```go
type Layer interface {
    // 送信時: 上位層のデータをラップし、ヘッダーを付与する
    Encapsulate(data string) string

    // 受信時: ヘッダーを解析・削除し、上位層へデータを渡す
    Decapsulate(data string) string

    // ログ出力用: 層の名称を返す
    Name() string
}
```

## 各層の詳細設計

各層はlayersパッケージ内に構造体として定義される。

### 第7層: Application Layer (アプリケーション層)

役割: ユーザーインターフェース、データの生成。

内部変数 (Private):

- messageBody (string): メール本文
- sender (string): 送信元メールアドレス
- recipient (string): 宛先メールアドレス

挙動: 「To: XX, From: XX, Body: XX」という形式の文字列を生成する。

### 第6層: Presentation Layer (プレゼンテーション層)

役割: データの表現形式管理。

内部変数 (Private):

- encoding (string): エンコード方式 (例: "UTF-8", "Base64")

挙動: データを指定された形式に変換したと仮定し、ヘッダーを付与する。

### 第5層: Session Layer (セッション層)

役割: 通信の開始・維持・終了。

内部変数 (Private):

- sessionID (string): セッション識別子

挙動: 通信開始を宣言し、データにセッションIDをタグ付けする。

### 第4層: Transport Layer (トランスポート層)

役割: データ転送の信頼性確保。

内部変数 (Private):

- srcPort (int): 送信元ポート番号
- dstPort (int): 宛先ポート番号

挙動: TCPヘッダー（ポート情報）を付与する。

### 第3層: Network Layer (ネットワーク層)

役割: エンドツーエンドの通信（IPアドレッシング）。

内部変数 (Private):

- srcIP (string): 送信元IPアドレス
- dstIP (string): 宛先IPアドレス

挙動: IPヘッダーを付与し、ルーティングを模倣する。

### 第2層: Data Link Layer (データリンク層)

役割: 直接接続された機器間の通信。

内部変数 (Private):

- srcMAC (string): 送信元MACアドレス
- dstMAC (string): 宛先MACアドレス

挙動: イーサネットフレーム（MACアドレス情報）を作成する。

### 第1層: Physical Layer (物理層)

役割: ビット列の電気信号変換。

内部変数 (Private):

- medium (string): 伝送媒体 (例: "Copper Wire")

挙動: 文字列データを「0101...」のビット列または「電圧High/Low」のログ表現に変換する。

## 処理プロセス (Main処理)

### 5.1 シナリオフロー

インスタンス化: 各層の構造体を初期化パラメータ（IPやポート等）と共に生成する。  
パイプライン構築: 各層のインスタンスをスライス（配列）に格納する。

```go
layers := []Layer{app, pres, sess, trans, net, link, phys}
```

送信 (Encapsulation Loop):  
スライスを先頭から順に走査し、Encapsulate メソッドを実行。  
処理結果を次の層への入力とする。

物理伝送シミュレーション:  
物理層の出力（ビット列/電圧）をコンソールに強調表示する。

受信 (Decapsulation Loop):  
スライスを末尾から逆順に走査し、Decapsulate メソッドを実行。  
ヘッダーが剥がされていく過程を表示する。

検証:  
最終出力が初期入力と一致することを確認する。

## 非機能要件

拡張性: 新しいプロトコル（例: UDP）を追加する場合、Layer インターフェースを実装した新しい構造体を作成するだけで組み込み可能とする。  
可読性: Go言語の標準的なフォーマット（gofmt）に準拠し、コメントを適切に記述すること。  
エラー処理: ヘッダー解析失敗時などは、Goの慣習に従い error 値を返し、適切に処理を中断・通知すること。
